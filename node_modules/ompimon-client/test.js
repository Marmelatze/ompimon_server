var
    BufferBuilder = require("buffer-builder"),
    stub = require("ompimon-protocol/test-client-stub"),
    _ = require("underscore")
;


    var WebSocket = require('ws');
    var ws = new WebSocket('ws://localhost:8080');

    var send = false;

    ws.on('open', function() {
        console.log("connected");


        ws.on('message', function(message) {
            console.log("received:");
            console.log(message);

            if (!send) {
                send = true;
                /*var data = stub.buildSend({
                    appId: 1,
                    sendId: null
                });*/
                var data = stub.buildCounter({
                    appId: 1,
                    counterId: null
                });
                console.log(data);
                var buffer = new BufferBuilder();
                buffer.appendUInt8(0x04);
                buffer.appendBuffer(data);
                ws.send(buffer.get(), {binary: true});
            }

        });

        var data = stub.buildLogin(stub.loginData);
        var buffer = new BufferBuilder();
        buffer.appendUInt8(0x01);
        buffer.appendBuffer(data);
        ws.send(buffer.get(), {binary: true});

    });