


exports.start = function() {
    var io = require('socket.io').listen(8080)
        ;
    var protocol = new (require("./protocol/").protocol);

    io.sockets.on('connection', function (socket) {
        socket.on('message', function (data) {
            data = JSON.parse(data);
            protocol.handle(socket, data);

            console.log(JSON.stringify(data, null, 2));
        });
        socket.on('disconnect', function() {
            console.log("disconnected");
        });
    });

    protocol.on('send', function(socket, data) {
        socket.send(JSON.stringify(data.getData()));
    });
};

exports.test = require("./test");