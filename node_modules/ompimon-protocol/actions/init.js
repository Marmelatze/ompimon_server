var action = require("./action").Action,
    binary = require("binary"),
    BufferBuilder = require('buffer-builder')
;

exports.Action = Init;

function Init() {
    action.call(this);
}


// inherit action
Init.super_ = action;
Init.prototype = Object.create(action.prototype);

Init.prototype = {
    parseFromCluster: function(buf) {
        var vars = binary.parse(buf)
            .word8('nameLength')
            .buffer('name', 'nameLength')
            .word8('usernameLength')
            .buffer('username', 'usernameLength')
            .word32bu('processes')
            .word32bu('nodes')
            .vars
        ;
        return {
            app: vars.name.toString('utf8'),
            username: vars.username.toString('utf8'),
            processes: vars.processes,
            nodes: vars.nodes
        };
    },

    processFromCluster: function(client, data, callback) {
        var result = new BufferBuilder();
        result.appendUInt8(0x00); // action id
        result.appendUInt8(0);
        result.appendString(client.id);

        callback(result.get());
    }
}