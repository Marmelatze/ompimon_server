var
    BufferStack = require("../BufferStack"),
    BufferBuilder = require("buffer-builder"),
    Parser = require("ompimon-protocol/parser")
    ;

module.exports = {
    testPush: function(test) {
        var buffer1 = new BufferBuilder();
        buffer1.appendUInt32BE(0x02);
        buffer1.appendUInt8(0x01);
        buffer1.appendUInt8(0x02);

        var bufferStack = new BufferStack();
        bufferStack.on('pushed', function() {
            var buf = bufferStack.pop();
            var parser = new Parser(buf);
            test.equal(parser.readUInt8(), 0x01);
            test.equal(parser.readUInt8(), 0x02);
            test.done();
        });
        bufferStack.push(buffer1.get());
    },

    testPushPartial: function(test) {
        var buffer1 = new BufferBuilder();
        buffer1.appendUInt32BE(0x02);
        buffer1.appendUInt8(0x01);

        var buffer2 = new BufferBuilder();
        buffer1.appendUInt32BE(0x02);

        var bufferStack = new BufferStack();
        bufferStack.on('pushed', function() {
            var buf = bufferStack.pop();
            console.log(buf);
            var parser = new Parser(buf);
            test.equal(parser.readUInt8(), 0x01);
            test.equal(parser.readUInt8(), 0x02);
            test.done();
        });
        bufferStack.push(buffer1.get());
        bufferStack.push(buffer2.get());
    }
}