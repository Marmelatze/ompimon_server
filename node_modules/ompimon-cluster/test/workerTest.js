var
    Worker = require("../worker"),
    Client = require('../client'),
    procotolStub = require("ompimon-protocol/test-stub"),
    Auth = require("ompimon-auth"),

    BufferBuilder = require("buffer-builder"),
    Parser = require("ompimon-protocol/parser")


;

Auth.auth.type = 'test';

client = new Client(new Buffer(256));
client.id = "1234567890yyyasdfasdfasdfasdfasd";

client.socket = {
    content: null,
    write: function(data) {
        this.content = data;
    }
};


var worker = new Worker(1234, false);

module.exports = {
    testProcess: function(test) {
        var data = procotolStub.buildInit(procotolStub.initData).get();
        var builder = new BufferBuilder();
        builder.appendUInt8(0x01); // init
        builder.appendBuffer(data);

        var buffer = builder.get();

        worker.process(client, buffer, function() {
            var result = client.socket.content;
            var parser = new Parser(result);
            test.equal(parser.readUInt8(), 0x01);
            test.equal(parser.readUInt8(), 0x00);

            test.done();

        });
    }
};